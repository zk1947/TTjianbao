
// $(function () {
var data = [{
	"stoneId": 1,
	"state": "第一代",
	"stateInt": 1,
	"level": 0,
	"selected": false,
	"goodsCode": 8218928198,
	"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",
	"children": [
		{
			"stoneId": 2,
			"selected": false,
			"stateInt": 2,
			"level": 1,
			"state": "第2代",
			"goodsCode": 8218928198,
			"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",
			"children": [
				{
					"stoneId": 3,
					"selected": false,
					"stateInt": 2,
					"state": "第3代",
					"goodsCode": 8218928198,
					"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",
					"children": [
						{
							"stoneId": 1,
							"selected": false,
							"stateInt": 2,
							"state": "第4代",
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",
							"children": [
							]
						},
						{
							"stoneId": 1,
							"selected": false,
							"state": "第4代",
							"stateInt": 3,
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",
							"children": [
							]
						},
						{
							"stoneId": 1,
							"selected": false,
							"stateInt": 3,
							"state": "第4代",
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",
							"children": [
								{
									"stoneId": 1,
									"selected": false,
									"stateInt": 3,
									"state": "第5代",
									"goodsCode": 8218928198,
									"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",
									"children": [
										{
											"stoneId": 1,
											"selected": true,
											"stateInt": 2,
											"state": "第6代",
											"goodsCode": 8218928198,
											"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

											"children": [
											]
										}
									]
								}
							]
						}
					]
				},
				{
					"stoneId": 1,
					"selected": false,
					"stateInt": 3,
					"state": "第3代",
					"goodsCode": 8218928198,
					"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

					"children": [
						{
							"stoneId": 1,
							"selected": false,
							"stateInt": 3,
							"state": "第4代",
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

							"children": [
							]
						}
					]
				}
			]
		},
		{
			"stoneId": 1,
			"selected": false,
			"stateInt": 3,
			"state": "第2代",
			"goodsCode": 8218928198,
			"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

			"children": [
				{
					"stoneId": 1,
					"selected": false,
					"stateInt": 3,
					"state": "第3代",
					"goodsCode": 8218928198,
					"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

					"children": [
						{
							"stoneId": 1,
							"selected": false,
							"stateInt": 3,
							"state": "第4代",
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

							"children": [
							]
						}
					]
				},
				{
					"stoneId": 1,
					"selected": false,
					"stateInt": 3,
					"state": "第3代",
					"goodsCode": 8218928198,
					"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

					"children": [
						{
							"stoneId": 1,
							"selected": false,
							"stateInt": 3,
							"state": "第4代",
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

							"children": [
							]
						}
					]
				}
			]
		},
		{
			"stoneId": 1,
			"selected": false,
			"stateInt": 3,
			"state": "第2代",
			"goodsCode": 8218928198,
			"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

			"children": [
				{
					"stoneId": 1,
					"selected": false,
					"stateInt": 3,
					"state": "第3代",
					"goodsCode": 8218928198,
					"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

					"children": [
						{
							"stoneId": 1,
							"selected": false,
							"stateInt": 3,
							"state": "第4代",
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

							"children": [
							]
						}
					]
				},
				{
					"stoneId": 1,
					"selected": false,
					"stateInt": 3,
					"state": "第3代",
					"goodsCode": 8218928198,
					"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

					"children": [
						{
							"stoneId": 1,
							"selected": false,
							"stateInt": 3,
							"state": "第4代",
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

							"children": [
							]
						}
					]
				},
				{
					"stoneId": 1,
					"selected": false,
					"stateInt": 3,
					"state": "第3代",
					"goodsCode": 8218928198,
					"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

					"children": [
						{
							"stoneId": 1,
							"selected": false,
							"stateInt": 3,
							"state": "第4代",
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

							"children": [
							]
						}
					]
				},
				{
					"stoneId": 1,
					"selected": false,
					"stateInt": 3,
					"state": "第3代",
					"goodsCode": 8218928198,
					"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

					"children": [
						{
							"stoneId": 1,
							"selected": false,
							"stateInt": 3,
							"state": "第4代",
							"goodsCode": 8218928198,
							"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",

							"children": [
							]
						}
					]
				}
			]
		}
	]
}];
var data1 = [{
	"stoneId": 1,
	"state": "第一代",
	"stateInt": 1,
	"level": 0,
	"selected": false,
	"goodsCode": 8218928198,
	"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",
	"children": [{
		"stoneId": 1,
		"state": "第2代",
		"stateInt": 1,
		"level": 0,
		"selected": false,
		"goodsCode": 8218928198,
		"coverUrl": "https://jianhuo-test.nos-eastchina1.126.net/user_dir/goods/15764084176167261.jpeg",
		"children": []
	}]
}]
// stoneTreeFunction(data1);
// setInterval(function () {
//   $('.border_active').addClass('border_active_big');
//   setTimeout(function () {
//     $('.border_active').removeClass('border_active_big');
//   }, 500)
// }, 1000)
// var div_width = $('.jOrgChart').width();
// var all_width = $(".jOrgChart").find("table:first").width();
// if(all_width>div_width){
//   $(".jOrgChart").find("table:first").css('transform', 'scale(' + div_width / all_width + ')')
//   $(".jOrgChart").find("table:first").css('transform-origin', '0 0');
//   $(".jOrgChart").height($(".jOrgChart").find("table:first").height() * (div_width / all_width))
// }

//原石家谱  jquery.jOrgChart.js  138行 点击收起展开家谱
var sourceOrderId = 0;
function setFamilyTreeData(data) {
    
	var stringData = JSON.parse(data);
//    var stringData = data;
    sourceOrderId = stringData.sourceOrderId;
	stoneTreeFunction(stringData.stoneTree);
	setInterval(function () {
		$('.border_active').addClass('border_active_big');
		setTimeout(function () {
			$('.border_active').removeClass('border_active_big');
		}, 500)
	}, 1000)
	var div_width = $('.jOrgChart').width();
	var all_width = $(".jOrgChart").find("table:first").width();
	if (all_width > div_width) {
		$(".jOrgChart").find("table:first").css('transform', 'scale(' + div_width / all_width + ')')
		$(".jOrgChart").find("table:first").css('transform-origin', '0 0');
		$(".jOrgChart").height($(".jOrgChart").find("table:first").height() * (div_width / all_width))
	}

}
/*
* 判断手机内核
* */
var browser = {
	versions: function () {
		var u = navigator.userAgent;
		return {//移动终端浏览器版本信息
			trident: u.indexOf('Trident') > -1, //IE内核
			presto: u.indexOf('Presto') > -1, //opera内核
			webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
			gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
			mobile: !!u.match(/AppleWebKit.*Mobile.*/) || !!u.match(/AppleWebKit/), //是否为移动终端
			ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
			android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
			iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者QQHD浏览器
			iPad: u.indexOf('iPad') > -1, //是否iPad
			webApp: u.indexOf('Safari') == -1 //是否web应该程序，没有头部与底部
		};
	}(),
	language: (navigator.browserLanguage || navigator.language).toLowerCase()
}


function showall(menu_list, parent) {
	for (let val of menu_list) {
		//stateInt 1已经寄回 2 寄售中 3成交
		var stateInt = val.stateInt;
		var stateText = val.state;
        
		var li_html = '';
		switch (stateInt) {
			case 1:
				if (val.selected) {
					li_html = "<li class='border border_active border_back_active'></li>"
				} else {
					li_html = "<li class='border border_back'></li>"
				}
				break;
			case 2:
				if (val.selected) {
					li_html = "<li class='border border_active'></li>"
				} else {
					li_html = "<li class='border border_ing'></li>"
				}
				break;
			case 3:
				if (val.selected) {
					li_html = "<li class='border border_active border_active_over'></li>"
				} else {
					li_html = "<li class='border'></li>";
				}

				stateText = val.price;
				break;
		}
		// if (val.selected) {
		//   li_html = "<li class='border border_active'></li>"
		// }
		if (val.children.length > 0) {
			var li = $(li_html);
			li.append('<div class="text" data-id="' + val.stoneId + '" data-stateint ="' + stateInt + '" data-level="' + val.level + '" data-source = "' + sourceOrderId + '">' + stateText + '</div>\n' +
				'              <img src="' + val.coverUrl + '" alt="Raspberry"/>\n' +
				'              <div class="org_bottom"><span>' + val.goodsCode + '</span></div>').append("<ul></ul>").appendTo(parent);
			//递归显示
			showall(val.children, $(li).children().eq(3));
		} else {
			$(li_html).append('<div class="text" data-id="' + val.stoneId + '" data-stateint ="' + stateInt + '" data-level="' + val.level + '" data-source = "' + sourceOrderId + '">' + stateText + '</div>\n' +
				'              <img src="' + val.coverUrl + '" alt="Raspberry"/>\n' +
				'              <div class="org_bottom"><span>' + val.goodsCode + '</span></div>').appendTo(parent);
		}
	}

}
function stoneTreeFunction(menu_list) {
	var showlist = $("<ul id='org' style='display:none'></ul>");
	showall(menu_list, showlist);
	$(".graphBox").append(showlist);
	$("#org").jOrgChart({
		chartElement: '#chart',
		dragAndDrop: true
	});
	var org_bottom = $('.org_bottom');
	for (var i = 0; i < org_bottom.length; i++) {
		var left = Number($(org_bottom[i]).width() + 6);
		$(org_bottom[i]).css('margin-left', -(left / 2));
	}
}


$('#chart').on('click', '.text', function () {
	var stoneId = $(this).data().id;
	var stateInt = Number($(this).data().stateint);
	var level = Number($(this).data().level);
    var sourceOrderId = $(this).data().source;
    if (sourceOrderId == '' || sourceOrderId == undefined ||sourceOrderId == 'undefined' || sourceOrderId == null) {
            sourceOrderId = 0;
        } else {
            sourceOrderId = 1;
        }
        sourceOrderId = 0;

	if (level != 0) {
		if (stateInt == 1) {
			if (browser.versions.ios || browser.versions.iPhone || browser.versions.iPad) {
              
                webkit.messageHandlers.showToast.postMessage('原石已寄回')
			} else if (browser.versions.android) {
				// 安卓
				window.appAndroid.showToast('原石已寄回')
			}
		} else {
			if (browser.versions.ios || browser.versions.iPhone || browser.versions.iPad) {
                webkit.messageHandlers.startNative.postMessage(["JHStoneDetailViewController", '{"stoneId":"' + stoneId + '","type":"' + sourceOrderId + '"}'])
			} else if (browser.versions.android) {
				window.appAndroid.startNative('com.yiding.jianhuo.stonedetail.view.StoneDetailActivity', '{"stoneId":"' + stoneId + '","saleType":"' + sourceOrderId + '"}')
			}
		}
	}


})


// })


